/*
Copyright (c) 2013 MileSplit, Inc.
Author: Jason Byrne
Contributor: Alan Szlosek
License: MIT

https://github.com/milesplit/dial
*/
(function(e){var t={},n={},r=null,i=e(document),s=navigator.geolocation;var o=function(){var e={},t={},n=-1;e.subscribe=function(e,r){t[e]=t[e]||[];var i=(++n).toString();t[e].push({token:i,func:r});return i};e.publish=function(e,n,r){if(!t[e]){return false}setTimeout(function(){var i=t[e],s=i?i.length:0;while(s--){i[s].func.call(r||this,n,e)}},0);return true};e.unsubscribe=function(e){for(var n in t){if(t[n]){for(var r=0,i=t[n].length;r<i;r++){if(t[n][r].token===e){t[n].splice(r,1);return e}}}}return false};return e}();var u=function(e){if(e.keys)return e.keys;var t=[];for(var n in e){t.push(n)}return t};e.dial={on:o.subscribe,off:o.unsubscribe,trigger:o.publish};e.dial.supports={touch:!!window.ontouchstart,mouse:!!window.onmousemove,keyboard:!!window.onkeydown,orientation:!!window.orientation,geolocation:!!s};e.dial.supports.speech=function(){var e=document.createElement("input");e.setAttribute("x-webkit-speech","x-webkit-speech");e.setAttribute("speech","speech");r="webkitSpeech"in e?"webkitspeechchange":"speechchange";return r in e}();e.dial.adapter=function(a,f){if(arguments.length==0)return t;else if(arguments.length==1)return t[a];t[a]=f;var l,c;if(a=="voice"){if(e.dial.supports.speech){l=function(n){c=t[a][r];if(typeof c=="string"){o.publish(c,n,n.target)}else if(e.isPlainObject(c)){if(n.results&&n.results.length>0){var i=n.results[0].utterance;c[i]&&o.publish(f[i],n,n.target)}}};n[a]&&i.off(n[a],l);i.on(r,l);n[a]=r}}else if(a=="geolocation"){if(e.dial.supports.geolocation){l=function(e){c=t[a]["watchPosition"];typeof c=="string"&&o.publish(c,e)};n[a]&&s.clearWatch(n[a]);n[a]=s.watchPosition(l)}}else{l=function(n){c=t[a][n.type];if(typeof c=="string"){o.publish(c,n,n.target)}else if(e.isPlainObject(c)){c[n.which]&&o.publish(c[n.which],n,n.target)}};n[a]&&i.off(n[a],l);n[a]=u(f).join(" ");i.on(n[a],l)}return e.dial}})(window.Zepto?Zepto:jQuery)
